---
title: "Annotation"
author: "CHARRIAT Florian"
date: "29 mars 2018"
output:
  html_document:
    code_folding: hide
    fig_caption: yes
    highlight: zenburn
    theme: cerulean
    toc: yes
    toc_depth: 5
    toc_float: yes
---

```{r knitr setup, include=FALSE,  eval=TRUE, echo=FALSE, warning=FALSE}
# knitr::opts_chunk$set(echo=TRUE, eval=TRUE, cache=TRUE, message=FALSE, warning=FALSE, comment="")

library(knitr)
options(width=300)
knitr::opts_chunk$set(
  fig.width = 10, 
  fig.height = 5, 
  fig.align = "center", 
  size = "tiny", 
  echo = TRUE, eval=TRUE, 
  warning = FALSE, message = FALSE, 
  results = TRUE, comment = "")
# knitr::asis_output("\\footnotesize")

```



```{r Package, echo = FALSE}
if(!require("knitr"))
  {
  install.packages('knitr')
}
if(!require("DT"))
  {
  install.packages('DT')
  }
library('knitr')
library('DT')
```


<p style="text-align:justify";>Dans un premier temps, Le script <a href="https://floriancha.github.io/Script/index.html" target="_blank">formatFastaName</a> est utilsé. Il va , pour chaque assemblage, changer les noms des scaffolds. Les scaffolds seront numérotés en fonction de leur longueur, ainsi le plus grand scaffold sera nommé scaffold_1. En description de chaque scaffold sa longueur sera donnée. En revanche seul la souche WHTQ va voir ses scaffold renommé, en revanche les autres souches de la litterature conseront leur nom de scaffold.</p>

<p style="text-align:justify";>L'annotation est réalisée avec l'outil BRAKER <a href='biblio.html#annotation2'>[6]</a>. Cet outil prend en input un fichier au format fasta contenant le génome à annoter et un fichier hints.Gff. Tous le pipeline d'annotation excépté le pré-traitement des données RNAseq inPlanta est lancée avec le script <a href="https://floriancha.github.io/Script/index.html" target="_blank">BRAKER_pipeline</a>.Ce script va réaliser toutes les étapes necessaires à la création des fichiers d'annotation.</p>

#Création du fichier hints

<p style="text-align:justify";>Le fichier hints.gff va être obtenu par alignement de données RNAseq avec le génome mais aussi par alignement d'un fichier d'annotation protéique du génome 70-15. Pour cela une première étape est de réaliser un alignement des fichiers RNAseq sélectionnés avec chaque génome assemblé puis de créer le fichier hints à l'aide de l'outil bam2hints. La deuxième étape sera l'utilisation de l'outil exonerate pour aligner le fichier protéine sur le génome et récupéré les introns hints. La dernière étape sera de merger les deux fichiers hints pour en former qu'un seul.</p>

<p style="text-align:justify";>Les deux fichiers hints (issu de données RNAseq ou du fichier d'annotation protéine) sont d'abord généré séparément. Ils seront ensuite mergés ensemble.</p>

###Hints RNAseq

<p style="text-align:justify";>Dans cette première étape, 32 fichiers de RNAseq ont été utilisés. Le tableau ci dessous présent tous les données RNAseq utilisées.</p>

```{r création tableau RNAseq ,echo=FALSE}
name <- c('FR13-myc','FR13.sari.3dpi.RNAtot','Mg1','Mg2','Mg3','SRR651980','SRR651981','SRR651982','SRR1561422','SRR298683','SRR298684','SRR298685','SRR298686','SRR298687','SRR298688','SRR298689','SRR298690','SRR298691','SRR298692','SRR651979','HH27','HH28','HH29','HH35','HH36','HH37','S37','S39','S40','S117','S119','S120')
description <- c('Projet GEMO Run1','Projet GEMO Run1 (inPlanta)','RNAseq Magnaburkho','RNAseq Magnaburkho','RNAseq Magnaburkho','RNAseq GY11','RNAseq GY11','RNAseq GY11','RNAseq GY11','RNAseq GY11','RNAseq GY11','RNAseq GY11','RNAseq GY11','RNAseq GY11','RNAseq GY11','RNAseq GY11','RNAseq GY11','RNAseq GY11','RNAseq GY11','RNAseq GY11','RNAseq InPlanta','RNAseq InPlanta','RNAseq InPlanta','RNAseq InPlanta','RNAseq InPlanta','RNAseq InPlanta','RNAseq InPlanta','RNAseq InPlanta','RNAseq InPlanta','RNAseq InPlanta','RNAseq InPlanta','RNAseq InPlanta')

data <- data.frame(description)
rownames(data) <- name

datatable(data, caption =" Tableau n°1: Liste des données RNAseq utilisées pour l'annotation", colnames = c('Id', 'description'),extensions = 'Buttons', options = list(dom = 'Blfrtip',buttons = c('copy', 'csv', 'excel', 'pdf', 'print')))
```

&nbsp;

####RNAseq InPlanta

<p style="text-align:justify";>Parmi ces 32 fichiers RNAseq, 13 proviennent de condition In Planta. Ce qui signifie que ces 13 fichiers contiennent les ARNs de M.oryzae mais aussi de l'hôte, ici le riz. Ces fichiers de RNAseq In planta doivent donc dans un premier temps être traités pour éliminer les ARNs de la plante en question. C'est pourquoi pour sélectionner seulement les séquences de M.oryzae, les 13 fichiers sont alignés avec le génome du riz. Seules les séquences qui ne se sont pas alignés avec le génome du riz sont récupérées. Pour cela le script <a href="https://floriancha.github.io/Script/index.html" target="_blank">forRNAseq_inPlanta</a> a été réalisé.</p>
<p style="text-align:justify";>Pour l'alignement l'outil TOGGLE <a href='biblio.html#annotation3'>[7]</a> est utilisé. Cette outils permet,ici, de lancer l'outils tophat sur tous les fichiers RNAseq disponible.L'outils donne en sortie un fichier unmapped.bam contenant les séquences qui ne se sont pas alignés avec le génome du riz. Ces fichiers bam sont récupérés puis convertis en fichier fastq grâce à l'outil samtool bam2fq.</p>


####Mapping des données RNAseq

<p style="text-align:justify";>Pour l'alignement des 32 RNAseq sur chaque assemblage, l'outils TOGGLE va être utilisé afin de mapper chaque donnée RNAseq avec l'assemblage. Puis les données sont triées avec l'outil picard pour ensuite être tous mergé ensemble avec l'outil Samtools merge. Enfin le fichier contenant tous les alignements entre les données RNAseq et le génome va être transformé à l'aide de l'outil Bam2hints et d'un script R.</p>

####Création du fichier hints issu du RNAseq

<p style="text-align:justify";>Une fois le fichier hints issu des données RNAseq obtenu, les assemblages sont aligné avec un fichier d'annotation des protéines du genome de référence (70-15). Pour cela l'outil Exonerate est utilisé. Le fichier d'alignement ainsi obtenu sera ensuite transformer en hints à l'aide de l'outil exonerate2hints.</p>

###Hints protéique

<p style="text-align:justify";>Dans cette deuxième étape, l'outil exonerate est utilisé pour aligner chaque assemblage avec le fichier protéique de référence. Du fichier de sortie de cet outil, un fichier hints est récupéré à l'aide du script perl exonerate2hints.</p>

<p style="text-align:justify";>Une fois les deux fichier hints crées, les positions des introns des deux fichiers hints sont récupérés puis mergés ensemble.</p>

#Lancement Braker

<p style="text-align:justify";>Ensuite l'outil BRAKER est lancé avec comme espèce Magnaporthe oryzae. Il prend en entrée, le fichier d'assemblage ainsi que le fichier hints_intron.gff crée précédement. Une fois le job fini, le script <a href="https://floriancha.github.io/Script/index.html" target="_blank">recupSeqFromGFF</a> recupSeqFromGFF.py est utilisé pour récupérer à partir du fichier GFF tous les transcripts dans un fichier fasta. Pour l'analyse du secretome un autre fichier fasta sera aussi généré contenant toutes les protéines issues des transcripts. Le fichier d'annotation gff3 est aussi récupéré. Les identifiants des gènes ont été modifiés afin d'homogénéiser la nomenclature avec la souche de référence. Les nouveaux identifiants seront de la forme suivante : </p>
* Gene : [Nom de l'espèce(Mo ou Mg)]_[Nom de la souche]_v1_[Numero du gène]
* Transcript : [Nom de l'espèce(Mo ou Mg)]_[Nom de la souche]_v1_[Numero du gène]T[Numero du transcript]
* Protéine : [Nom de l'espèce(Mo ou Mg)]_[Nom de la souche]_v1_[Numero du gène]P[Numero du transcript d'où provient la protéine]



